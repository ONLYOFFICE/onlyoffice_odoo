<odoo>
    <template id="onlyoffice_editor_extension" inherit_id="onlyoffice_odoo.onlyoffice_editor" name="ONLYOFFICE Editor Extension">
        <xpath expr="//div[@id='test']" position="replace">
            <t t-call="onlyoffice_odoo.onlyoffice_layout">
                    <div id="doceditor"></div>
                    <div id="error" class="w-25 m-auto my-5 py-5 d-flex flex-column d-none">
                        <img src="/onlyoffice_odoo/static/svg/logo.svg" alt="ONLYOFFICE logo"></img>
                        <div class="my-3 alert alert-danger">
                            <p>
                                ONLYOFFICE cannot be reached. Please contact admin.
                            </p>
                        </div>
                    </div>
                    <script type="text/javascript" t-att-src="docApiJS"></script>
                    <script type="text/javascript">
                        var config = JSON.parse('<t t-out="editorConfig" />');
                        
                        config.editorConfig.customization.submitForm = true;
                        config.events = {
                            onRequestSaveAs: async (event) => {
                                odoo.define('onlyoffice_odoo.templates', function (require) {
                                    'use strict';
                                    var ajax = require('web.ajax');
                                    console.log("ajax", ajax);
                                    console.log("event", event);
                                    ajax.rpc(`/onlyoffice/upload_file_from_url`, {
                                        url: event.data.url,
                                        title: event.data.title
                                    });
                                })
                            },
                            onDocumentReady: () => {
                                console.log("onDocumentReady")
                                window.connector = docEditor.createConnector();
                                console.log("connector", connector)

                                connector.executeMethod("GetAllComments", null, function (data) {
                                    console.log(data);
                                });

                                window.addEventListener("message", (event) => {
                                    if (event.data === "123") {
                                        //var currentdate = Date.now();
                                        //var datetime = "" + currentdate;
                                        //window.connector.executeMethod("AddComment", [{ Text: "comment", UserName: "Administrator", Time: datetime }]);
                                        //window.connector.executeMethod("MoveCursorToEnd", [true]);


                                        connector.callCommand(function() {
                                            var oDocument = Api.GetDocument();
                                            var oTextForm = Api.CreateTextForm({
                                                "key": "Personal information",
                                                "placeholder": "First name",
                                                "multiLine": true,
                                                "autoFit": true
                                            });
                                            oTextForm.ToInline();
                                            var oParagraph = Api.CreateParagraph();
                                            oParagraph.AddElement(oTextForm);
                                            //oDocument.Push(oParagraph);
                                            oDocument.InsertContent([oParagraph], true, { "KeepTextOnly": true });
                                        }, () => console.log("CreateTextForm", this));

                                        console.log("onlyoffice_editor_extension this", this)
                                        console.log("onlyoffice_editor_extension event", event)
                                        console.log("onlyoffice_editor_extension window", window)
                                    }
                                }, false);


                            }
                        };

                        if (window.DocsAPI) {
                            var docEditor = new DocsAPI.DocEditor("doceditor", config);
                        } else {
                            document.getElementById("error").classList.remove("d-none");
                        }
                    </script>
                    <div id="extension"></div>
                </t>
        </xpath>
    </template>



    <!--<template id="onlyoffice_editor_extension" inherit_id="onlyoffice_odoo.onlyoffice_editor" name="ONLYOFFICE Editor Extension">
        <xpath expr="//div[@id='extension']" position="after">
            <div>extension extension extension extension extension extension extension extension extension</div>
            <script type="text/javascript">
                window.addEventListener("message", (event) => {
                    

                    if (event.data === "123") {
                        //var currentdate = Date.now();
                        //var datetime = "" + currentdate;
                        //window.connector.executeMethod("AddComment", [{ Text: "comment", UserName: "Administrator", Time: datetime }]);
                        //window.connector.executeMethod("MoveCursorToEnd", [true]);


                        window.connector.callCommand(function() {
                            var oDocument = Api.GetDocument();
                            var oTextForm = Api.CreateTextForm({
                                "key": "Personal information",
                                "placeholder": "First name",
                                "multiLine": true,
                                "autoFit": true
                            });
                            oTextForm.ToInline();
                            var oParagraph = Api.CreateParagraph();
                            oParagraph.AddElement(oTextForm);
                            //oDocument.Push(oParagraph);
                            oDocument.InsertContent([oParagraph], true, { "KeepTextOnly": true });
                        }, () => console.log("CreateTextForm", this));

                        console.log("onlyoffice_editor_extension this", this)
                        console.log("onlyoffice_editor_extension event", event)
                        console.log("onlyoffice_editor_extension window", window)
                    }
                }, false);
                
            </script>
        </xpath>
    </template>-->
</odoo>