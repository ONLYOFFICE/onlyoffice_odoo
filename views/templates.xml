<?xml version="1.0" encoding="utf-8"?>

<!-- -->
<!-- (c) Copyright Ascensio System SIA 2023 -->
<!-- -->
<!-- This program is a free software product. You can redistribute it and/or -->
<!-- modify it under the terms of the GNU Affero General Public License (AGPL) -->
<!-- version 3 as published by the Free Software Foundation. In accordance with -->
<!-- Section 7(a) of the GNU AGPL its Section 15 shall be amended to the effect -->
<!-- that Ascensio System SIA expressly excludes the warranty of non-infringement -->
<!-- of any third-party rights. -->
<!-- -->
<!-- This program is distributed WITHOUT ANY WARRANTY; without even the implied -->
<!-- warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For -->
<!-- details, see the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html -->
<!-- -->
<!-- You can contact Ascensio System SIA at 20A-12 Ernesta Birznieka-Upisha -->
<!-- street, Riga, Latvia, EU, LV-1050. -->
<!-- -->
<!-- The  interactive user interfaces in modified source and object code versions -->
<!-- of the Program must display Appropriate Legal Notices, as required under -->
<!-- Section 5 of the GNU AGPL version 3. -->
<!-- -->
<!-- Pursuant to Section 7(b) of the License you must retain the original Product -->
<!-- logo when distributing the program. Pursuant to Section 7(e) we decline to -->
<!-- grant you any rights under trademark law for use of our trademarks. -->
<!-- -->
<!-- All the Product's GUI elements, including illustrations and icon sets, as -->
<!-- well as technical writing content are licensed under the terms of the -->
<!-- Creative Commons Attribution-ShareAlike 4.0 International. See the License -->
<!-- terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode -->
<!-- -->

<odoo>
    <data>

        <template id="onlyoffice_frontend_layout" name="Frontend Layout" inherit_id="web.frontend_layout">
            <xpath expr="//title" position="replace">
                <title>
                    ONLYOFFICE - <t t-out="docTitle" />
                </title>
            </xpath>
            <xpath expr="//link[@type='image/x-icon']" position="replace">
                <link rel="icon" t-att-href="docIcon" type="image/x-icon" />
            </xpath>
        </template>

        <template id="onlyoffice_editor" name="ONLYOFFICE Editor">
            <t t-call="onlyoffice_odoo_connector.onlyoffice_frontend_layout">
                <t t-set="html_data" t-value="{'style': 'height: 100%;'}"/>
                <t t-set="body_classname" t-value="'bg-100'"/>
                <t t-set="no_header" t-value="True"/>
                <t t-set="no_footer" t-value="True"/>

                <div id="doceditor"></div>
                <div id="error" class="w-25 m-auto my-5 py-5 d-flex flex-column">
                    <img src="/onlyoffice_odoo_connector/static/svg/logo.svg" alt="ONLYOFFICE logo"></img>
                    <div class="my-3 alert alert-danger">
                        <p>
                            An error has occurred while opening the file. Please check connection settings or contact your administrator. Press “OK” button to close this page. 
                        </p>
                        <p>
                            Find more information about connecting ONLYOFFICE Document Server <a href="https://api.onlyoffice.com/editors/troubleshooting">here</a>.
                        </p>
                    </div>
                    <button id="button-close" class="btn btn-primary"><strong>OK</strong></button>
                </div>
                <script type="text/javascript" t-att-src="docApiJS"></script>
                <script type="text/javascript">
                    var config = JSON.parse('<t t-out="editorConfig" />');

                    if (window.DocsAPI) {
                        var docEditor = new DocsAPI.DocEditor("doceditor", config);
                    } else {
                        document.getElementById("error").classList.remove("d-none");
                        document.getElementById("button-close").onclick = function () {
                            window.close();
                        };
                    }
                </script>
            </t>
        </template>
    </data>
</odoo>